<link rel="import" href="../../polymer/polymer.html"><link rel="import" href="../event-emitter-behavior/event-emitter-behavior.html"><!--
    <parallax-scroller-behavior>`element <text>.

    Example:
        <parallax-scroller-behavior></parallax-scroller-behavior>

    @element parallax-scroller-behavior
    @demo demo/index.html
--><script>"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GrowCssParallaxCanvas=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return e.options=d,e.image=c,e.wrapper=a,e.isLoaded=!1,e}return _inherits(b,a),_createClass(b,[{key:"hasTranslate3D",value:function(){var a=document.createElement("div");return this.prefix(a.style,"transform","translate3d(0, 0, 0)"),/translate3d/g.test(a.style.cssText)}},{key:"load",value:function(){var a=this,b=this.image;b.width&&b.height&&b.complete?this.onImageLoaded():b.onload=function(){return a.onImageLoaded()}}},{key:"onImageLoaded",value:function(){this.isLoaded=!0,this.update(),this.fire("loaded",this.image)}},{key:"update",value:function(){var a=this.image.naturalWidth||this.image.width,b=this.image.naturalHeight||this.image.height,c=a/b,d=this.size,e=this.image;return d.width/c<=d.height?(e.height=d.height,e.width=d.height*c):(e.width=d.width,e.height=d.width/c),e.style.top=-~~((e.height-d.height)/2)+"px",e.style.left=-~~((e.width-d.width)/2)+"px",this}},{key:"draw",value:function(a){var b=this.size,c=this.image,d=this.offset.top+b.height;d*=this.options.center+a.height,d/=2-a.scrollTop,d/=a.height-1,d*=c.height/b.height/2,d*=this.options.intensity,this.hasTranslate3D()?this.prefix(c.style,"transform","translate3d(0, "+-d+"%, 0)"):this.prefix(c.style,"transform","translate(0, "+-d+"%)")}},{key:"prefix",value:function c(a,b,d){for(var e=a,f=["ms","o","Moz","webkit",""],g=f.length;g--;){var c=f[g],h=c?c+b[0].toUpperCase()+b.substr(1):b.toLowerCase()+b.substr(1);if(h in e)return e[h]=d,!0}return!1}},{key:"bounds",get:function(){return this.wrapper.getBoundingClientRect()}},{key:"offset",get:function(){return{top:this.wrapper.offsetTop,left:this.wrapper.offsetLeft}}},{key:"size",get:function(){var a=this.bounds;return{height:0|a.height,width:0|a.width}}}]),b}(GrowCssEventEmitter);
  "use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),PARALLAX_RESIZE_DELAY=20,GrowCssParallaxStage=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.resizeTimer=null,a.tick=!1,a.bind(),a}return _inherits(b,a),_createClass(b,[{key:"requestAnimationFrame",value:function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){var b=a;setTimeout(b,1e3/60)}}},{key:"bind",value:function(){var a=this;window.addEventListener("scroll",function(){return a.scroll()},!0),window.addEventListener("mousewheel",function(){return a.scroll()},!0),window.addEventListener("touchmove",function(){return a.scroll()},!0),window.addEventListener("resize",function(){return a.resize()},!0),window.addEventListener("orientationchange",function(){return a.resize()},!0),window.onload=function(){return a.scroll()}}},{key:"scroll",value:function(){var a=this;this.tick||(this.tick=!this.tick,this.requestAnimationFrame(function(){return a.update()}))}},{key:"update",value:function(){this.fire("scroll",this.scrollTop),this.tick=!this.tick}},{key:"resize",value:function(){var a=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){return a.fire("resize",a.size)},PARALLAX_RESIZE_DELAY)}},{key:"scrollTop",get:function(){var a=(window.pageYOffset||document.scrollTop)-(document.clientTop||0);return window.isNaN(a)?0:a}},{key:"height",get:function(){return window.innerHeight}},{key:"width",get:function(){return window.innerWidth}},{key:"size",get:function(){return{width:this.width,height:this.height}}}]),b}(GrowCssEventEmitter);
  "use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GrowCss=GrowCss||{},GrowCssParallaxScroller=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return e.stage||(e.stage=new GrowCssParallaxStage),e.dom=a,e.options=d||{offsetYBounds:50,intensity:30,center:.5},e.selector=Array.prototype.slice.call(e.nodeWrapper(a.querySelector(c))),e.canvases=[],e.add(e.selector),e}return _inherits(b,a),_createClass(b,[{key:"init",value:function(){return this.canvases.length?(this.imagesLoaded=0,this.bind()):console.warn('No images were found with the selector "'+this.selector+'"'),this}},{key:"bind",value:function(){var a=this;return this._onResize=function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return a.resize.apply(a,c)},this._onScroll=function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return a.scroll.apply(a,c)},this.stage.listen("resize",this._onResize),this.stage.listen("scroll",this._onScroll),this.canvases.forEach(function(b){b.listenOnce("loaded",function(){return a.onCanvasLoaded(b)}),b.load(),console.log(b)}),this}},{key:"refresh",value:function(){return this.onResize(this.stage.size).onScroll(this.stage.scrollTop),this}},{key:"onCanvasLoaded",value:function(a){return this.fire("image:loaded",a.img,a),this.imagesLoaded++,a.draw(this.stage),this.imagesLoaded===this.canvases.length&&this.fire("images:loaded"),this}},{key:"scroll",value:function(){for(var a=this.canvases.length,b=this.options.offsetYBounds,c=this.stage.scrollTop;a--;){var d=this.canvases[a],e=d.size.height,f=d.offset,g=f.top+e;g-=c,d.isLoaded&&g+b>0&&g-b<c+this.stage.height&&(d.draw(this.stage),this.fire("draw",d.img))}return this.fire("update",c),this}},{key:"add",value:function(a){return this.canvases=this.canvases.concat(this.createCanvases(a)),this}},{key:"remove",value:function(a){var b=this;return a.forEach(function(a){for(var c=b.canvases.length;c--;)if(a===b.canvases[c].img){b.canvases.splice(c,1);break}}),this}},{key:"destroy",value:function(){return this.forget("*"),this.canvases=[],this.stage.forget("resize",this._onResize),this.stage.forget("scroll",this._onScroll),this}},{key:"resize",value:function(){for(var a=this.canvases.length;a--;){var b=this.canvases[a];if(!b.isLoaded)return;b.update().draw(this.stage)}this.fire("resize")}},{key:"createCanvases",value:function(a){var b=this;return a.map(function(a){var c=b.elementData(a);return new GrowCssParallaxCanvas(b.dom,a,{intensity:"undefined"!=typeof c.intensity?+c.intensity:b.options.intensity,center:"undefined"!=typeof c.center?+c.center:b.options.center})})}},{key:"elementData",value:function(a,b){return b?a.dataset[b]||a.getAttribute("data-"+b):a.dataset||Array.prototype.slice.call(a.attributes).reduce(function(a,b){var c=a;return/data-/.test(b.name)&&(c[b.name]=b.value),c},{})}},{key:"nodeWrapper",value:function(a){var b=document.createDocumentFragment();return b.appendChild(a),b.childNodes}}]),b}(GrowCssEventEmitter),GcParallaxScrollerBehavior={parallax:function(a,b){return new GrowCssParallaxScroller(a,b)}};GrowCss.ParallaxScrollerBehavior=GcParallaxScrollerBehavior;</script>